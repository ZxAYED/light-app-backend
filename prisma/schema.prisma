generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}
model User {
  id        String    @id @default(uuid())
  email     String  @unique
  password  String
  role      UserRole  @default(PARENT)
  createdAt DateTime  @default(now())


  goalsAuthored Goal[]
  parentProfile ParentProfile?
  childProfile  ChildProfile?
}

enum UserRole {
  PARENT
  CHILD
}
model ParentProfile {
  id              String      @id @default(uuid())
  userId          String      @unique

  name            String
  phone           String
  avatar          String?
  gender          Gender?
  dateOfBirth     DateTime?
  location        String?

  pushNotification Boolean? @default(true)
  dailyReminders   Boolean? @default(true)
  childTaskUpdates Boolean? @default(true)

  user        User           @relation(fields: [userId], references: [id])
  children    ChildProfile[]
}
model ChildProfile {
  id            String     @id @default(uuid())
  userId        String     @unique
  parentId      String

 accountType        ChildAccountType @default(MODERATOR)
  name          String
  gender        Gender?
  phone         String?
  email         String?
  dateOfBirth   DateTime?
  location      String?
  avatar        String?

  coins         Int         @default(0)
  relation      String?

  addAccounts        Boolean @default(false)
  accessAccounts     Boolean @default(false)
  editProfile        Boolean @default(true)
  createGoals        Boolean @default(true)
  approveTasks       Boolean @default(true)
  giveFeedback       Boolean @default(true)
  customizeAvatar    Boolean @default(true)
  deleteGoals        Boolean @default(false)
  unlockRewards      Boolean @default(true)
  deleteAccount      Boolean @default(false)

  goals           Goal[]
  parent      ParentProfile  @relation(fields: [parentId], references: [id])
  user        User           @relation(fields: [userId], references: [id])
}
enum Gender {
  MALE
  FEMALE
}
enum ChildAccountType {
  ADMIN
  MODERATOR
  VIEWER
}





model Goal {
  id            String      @id @default(uuid())
  childId       String
  authorId      String
  authorRole    AuthorRole  @default(PARENT)

  title         String
  description   String?
  type          GoalType    @default(ONE_TIME)
  status        GoalStatus  @default(ACTIVE)
  rewardCoins   Int         @default(0)
  startDate     DateTime?
  endDate       DateTime?
  createdAt     DateTime    @default(now())

  child         ChildProfile @relation(fields: [childId], references: [id])
  author        User         @relation(fields: [authorId], references: [id])
}

enum AuthorRole {
  PARENT
  CHILD
}

enum GoalStatus {
  ACTIVE       // currently running
  PAUSED       // temporarily stopped by parent
  COMPLETED    // goal fully done
  CANCELLED    // removed / ended early
}
enum GoalType {
  ONE_TIME    // do it once and done
  DAILY       // repeat every day
  WEEKLY      // repeat every week
  MONTHLY     // repeat every month
}
